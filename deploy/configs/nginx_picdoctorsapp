
# I got this from the optimizing SSL guide: http://nginx.org/en/docs/http/configuring_https_servers.html
ssl_session_cache   shared:SSL:10m;
ssl_session_timeout 10m;

# Redirect http://picdoctors.com to https://www.picdoctors.com
server {
    listen 80;
    client_max_body_size 50m;
    server_name picdoctors.com;
    rewrite ^(.*) https://www.picdoctors.com$1 permanent;
}

# Redirect http://www.picdoctors.com to https://www.picdoctors.com
server {
    listen 80;
    client_max_body_size 50m;
    server_name www.picdoctors.com;
    rewrite ^(.*) https://www.picdoctors.com$1 permanent;
}

# Redirect https://picdoctors.com to https://www.picdoctors.com
# TODO - I think I need to do this on a second IP address. Is that
# true?
#server {
#    listen 443;
#    server_name picdoctors.com;
#    rewrite ^(.*) https://www.picdoctors.com$1 permanent; 
#    ssl on;
#    ssl_certificate /home/ubuntu/picdoctors_bundle.crt;
#    ssl_certificate_key /home/ubuntu/picdoctors_nopassword.key;
#}
# Above is temporarily disabled while I figure out the cert problems

server {
    # To ensure you do not cause issues with certificates,
    # explicitly bind the domain to its intended IP.
    # listen 1.1.1.1:443;
    listen 443 default_server;
    server_name www.picdoctors.com;
    root /code/picdoctors;

    location /static/ {
        alias /code/picdoctors/static/;
        #include /etc/nginx/gzip.conf;
        expires 30d;
        access_log off;
    }
    
    location /favicon.ico {
        alias /code/picdoctors/static/images/favicon.ico;
    }

    location /robots.txt {
        alias /code/picdoctors/static/rootdir/robots.txt;
    }

    location / {
        include uwsgi_params;
        uwsgi_pass unix:/tmp/picdoctorsapp.sock;
    }

    # ssl stuff
    ssl on;
    ssl_certificate /code/picdoctors/deploy/configs/certs/picdoctors_bundle.crt;
    ssl_certificate_key /code/picdoctors/deploy/configs/certs/picdoctors_nopassword.key;

}

